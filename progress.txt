# Ralph Progress Log

Started: 2026-02-20
Project: terraform-town - Mock AWS Provider

## Codebase Patterns

- Schema location: `packages/aws-mock/schema/aws-provider-schema.json` (AWS provider v5.100.0, 13MB)
- Schema access: `data.provider_schemas["registry.terraform.io/hashicorp/aws"].resource_schemas["aws_s3_bucket"]`
- Test files: `packages/aws-mock/tests/*.test.ts` using `bun:test`
- Formatting: `npx oxfmt format <file>` (oxfmt not globally installed)
- Schema parser: `parseResourceDefinition(type)` in `packages/aws-mock/src/utils/schema-parser.ts`
- Schema attribute categories: required (required=true), optional (optional=true, may also be computed), computed-only (computed=true && !optional)
- aws_s3_bucket has 0 required attrs, ~10 optional, 7 computed-only, 10 nested blocks

## 2026-02-20 14:59 - US-002
- Installed terraform via homebrew
- Version: v1.5.7 (last open-source version before BUSL license)
- Note: Homebrew won't update beyond this due to license change
## 2026-02-20 14:59 - US-001
- Initialized bun workspace
- packages/aws-mock created with Hono, Effect dependencies
- packages/terraform-provider-aws-mock created (empty, for Go provider)
- bun install succeeded
---

## 2026-02-20 15:20 - US-003
- Dumped AWS provider schema (hashicorp/aws v5.100.0) to packages/aws-mock/schema/aws-provider-schema.json
- Created temp terraform config in /tmp/tf-schema-dump to download provider and dump schema
- Added schema validation tests in packages/aws-mock/tests/schema.test.ts
- Added .gitignore (node_modules, .terraform, tfstate files)
- Files changed: packages/aws-mock/schema/aws-provider-schema.json, packages/aws-mock/tests/schema.test.ts, .gitignore
- **Learnings for future iterations:**
  - Schema is 13MB, contains 1526 resource types from AWS provider v5.100.0
  - Provider schema key format is `registry.terraform.io/hashicorp/aws`
  - Schema structure: `provider_schemas[key].resource_schemas[resource_type]`
  - `terraform providers schema -json` requires `terraform init` to have been run first
  - oxfmt is not installed globally; use `npx oxfmt` as fallback
---

## 2026-02-20 - US-004
- Created schema parser utility at `packages/aws-mock/src/utils/schema-parser.ts`
- Created tests at `packages/aws-mock/tests/schema-parser.test.ts` (8 tests)
- Files changed: packages/aws-mock/src/utils/schema-parser.ts, packages/aws-mock/tests/schema-parser.test.ts
- **Learnings for future iterations:**
  - Terraform schema attributes have 3 categories: required, optional (may also be computed), computed-only
  - `bucket` in aws_s3_bucket is optional+computed (auto-generated if omitted)
  - Most aws_s3_bucket nested blocks are deprecated in favor of standalone resources (e.g., aws_s3_bucket_versioning)
  - Schema block_types have nesting_mode: "single", "list", or "set"
  - normalizeType helper needed to handle Terraform type tuples like `["map", "string"]` â†’ `"map(string)"`
---

